{% extends "layout.html" %}
{% load static %}

{% block annotation_progress %}
{% include "annotation_status.html" %}
<a class="navbar-brand" href="/annotation/logout/"> 登出 </a>
{% endblock %}

{% block body %}

{% if all_finished %}
<h1>所有標記皆已完成！謝謝您！</h1>
{% else %}
<div class="container-fluid">
  <h2>標記 Triples</h2>

<pre style="word-wrap: break-word;white-space: pre-wrap;font-size: 20pt;">
  {{ entry.content }}
</pre>

<form name="annotation" action="/annotation/" method="post">
  {% csrf_token %}
  <input type="hidden" name="user" value="{{ entry.author }}">
  <input type="hidden" name="id" value="{{ entry.id }}">
  <div style="margin-bottom: 2em">
    以上的 {{ entry.source_type }} 是否包含 "{{ entry.author }}" 的生活經歷:
    <input type="radio" onclick="radioBtn();" name="checkEvent" value="notEvent" id="no" style="width:20px;height:20px">否 &nbsp&nbsp
    <input type="radio"                                               onclick="radioBtn();" name="checkEvent" value="hasEvent" id="yes" style="width:20px;height:20px">是 &nbsp&nbsp
    <input type="radio" onclick="radioBtn();" name="checkEvent" value="pass" id="pass" style="width:20px;height:20px">Pass
  </div>
  <div id="showBlock" style="display:none">
    <table id="eventTab" class="table table-striped">
      <thead>
        <tr align="center" id="tr0">
          <th></th>
          <th>類別</th>
          <th>Subject,</th>
          <th>Predicate</th>
          <th>Object</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        {% for triple in pa.triples %}
        <tr align="left" id="tr{{ forloop.counter }}">
          <td>
            <button type="button" class="btn btn-link" onclick="removeRow({{ forloop.counter }});">
              <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
            </button>
          </td>
          <td>
            <label class="radio-inline">
              <input type="radio" name="eventType{{ forloop.counter }}" value="explicit" {% if triple.eventType == 'explicit' %} checked="checked"
            {% endif %}>Explicit
            </label><br>
            <label class="radio-inline">
              <input type="radio" name="eventType{{ forloop.counter }}" value="implicit" {% if triple.eventType == 'implicit' %} checked="checked"
            {% endif %}>Implicit
            </label>
          </td>
          <td>
            <div class="input-group">
              <input type="text" class="form-control" value="{{ triple.subject }}" name="subject{{ forloop.counter }}" id="subject{{ forloop.counter }}"/>
              <span class="input-group-btn">
                <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText('subject',{{ forloop.counter }});">
              </span>
            </div>
          </td>
          <td>
            <div class="input-group">
              <input type="text" class="form-control" value="{{ triple.predicate }}" name="predicate{{ forloop.counter }}" id="predicate{{ forloop.counter }}"/>
              <span class="input-group-btn">
                <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText('predicate',{{ forloop.counter }});">
              </span>
            </div>
          </td>
          <td>
            <div class="input-group">
              <input type="text" class="form-control" value="{{ triple.object }}" name="object{{ forloop.counter }}" id="object{{ forloop.counter }}"/>
              <span class="input-group-btn">
                <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText('object',{{ forloop.counter }});">
              </span>
            </div>
          </td>
          <td>
            <div class="input-group">
              <input type="text" class="form-control" value="{{ triple.time }}" name="time{{ forloop.counter }}" id="time{{ forloop.counter }}"/>
              <span class="input-group-btn">
                <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText('time',{{ forloop.counter }});">
              </span>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="100%" align="center">
            <button id="addBtn" type="button" class="btn btn-link">
              <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
              加一列
            </button>
          </td>
        </tr>
      </tfoot>
    </table>
    <br>
    <br>
    {% if entry.media %}
    <div style="padding:1em; margin-top: 1em;  margin-bottom: 1em; border: solid 1px; border-radius: 10px;">
      
      請輸入圖片描述：<br>
      <img src="/static/images/{{ entry.media }}" alt="" width="400"/><br>
      <h4>圖片中的環境元素</h4>
      <input type="text" name="imgDescEnvironment" value="{{ pa.imgDescEnvironment }}" style="width:400px; margin: 1em 0" class="form-control">      
      <h4>發文者附上該圖片的意圖</h4>
      <input type="text" name="imgDescIntention" value="{{ pa.imgDescIntention }}" style="width:400px; margin: 1em 0" class="form-control">
      <h4>圖片和句子之間的關聯</h4>
      <input type="text" name="imgDescConnection" value="{{ pa.imgDescConnection }}" style="width:400px; margin: 1em 0" class="form-control">
    </div>
    {% endif %}
    <hr>
    {% include "annotate_frame.html" %}
  </div>
  <br>
  <br>
  <br>
  <input type="submit" class="btn btn-primary" value="送出" id="submit" style="margin-top:2%;margin-bottom:2%">
</form>


</div>

<script>
    function radioBtn()
    {
      if (document.getElementById('yes').checked) {
        document.getElementById('showBlock').style.display = 'block';
      }
      else document.getElementById('showBlock').style.display = 'none';
    }
  $( "form" ).submit(function( event ) {
    //alert( "Handler for .submit() called." );

    //event.preventDefault();
  });

var id =  {{ pa.triples | length }} + 1;

$(document).ready(function(){
  document.getElementById({'hasEvent': 'yes', 'notEvent': 'no', 'pass': 'pass'}['{{pa.checkEvent}}']).checked = true;
  radioBtn();

  //add input block in showBlock
  $("#addBtn").click(function(){
    addRow(id)
    id ++
  });
});

function addRow (id) {
  boxName1 = 'subject';
  boxName2 = 'predicate';
  boxName3 = 'object';
  boxName4 = 'time';
  $("#eventTab>tbody").append(`
    <tr id="tr${id}">
      <td>
        <button type="button" class="btn btn-link" onclick="removeRow(${id});">
          <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
        </button>
      </td>
      <td>
        <label class="radio-inline">
          <input type="radio" name="eventType${id}" checked="checked" value="explicit">Explicit<br>
        </label><br>
        <label class="radio-inline">
          <input type="radio" name="eventType${id}" value="implicit">Implicit</td>
        </label>
      <td>
        <div class="input-group">
          <input type="text" class="form-control" value="我" name="subject${id}" id="subject${id}"/>
          <span class="input-group-btn">
            <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText(boxName1,${id});">
          </span>
        </div>
      </td>
      <td>
        <div class="input-group">
          <input type="text" class="form-control" value="" name="predicate${id}" id="predicate${id}"/>
          <span class="input-group-btn">
            <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText(boxName2,${id});">
          </span>
        </div>
      </td>
      <td>
        <div class="input-group">
          <input type="text" class="form-control" value="" name="object${id}" id="object${id}"/>
          <span class="input-group-btn">
            <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText(boxName3,${id});">
          </span>
        </div>
      </td>
      <td>
        <div class="input-group">
          <input type="text" class="form-control" value="發文時間" name="time${id}" id="time${id}"/>
          <span class="input-group-btn">
            <input type="button" class="btn btn-default" value="貼上" onclick="getSelectedText(boxName4,${id});">
          </span>
        </div>
      </td>
    </tr>`);
}

function removeRow(id) {
  if ($('#eventTab>tbody>tr').length > 1){
    $("#tr"+id).remove();
  }
  else{
    alert('最少要有一個triple');
  }
}

function check(){
  return true;
}

function getSelectedText(name,id){
  elemID = name+id;
  text = '';
  if (window.getSelection) {
    text = window.getSelection();
  } else if (document.selection) {
    text =  document.selection.createRange().text;
  }
  else if(window.document.selection){
    text = window.document.selection.createRange().text;
  }
  else{
    text = '';
  }
  $('#'+elemID).val(text);
}


</script>
<style>
  input[type=radio]{
    margin-right: 5pt
  }
</style>

{% endif %}

{% endblock body %}